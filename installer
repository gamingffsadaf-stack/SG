#!/bin/bash
set -e

#==============================================================#
# 🦋 PTERODACTYL INSTALLER
# Created by: @its_sadaf_officail
# Our team : % SDF >..
# Features:
#   • Animated menu
#   • Colorful UI
#   • Panel + Wings + Blueprint theme
#   • Uninstaller
#==============================================================#

LOG_PATH="/var/log/ptero-pro.log"

#---------------------- COLORS ----------------------#
RED='\033[1;31m'
GREEN='\033[1;32m'
YELLOW='\033[1;33m'
BLUE='\033[1;34m'
CYAN='\033[1;36m'
MAGENTA='\033[1;35m'
WHITE='\033[1;37m'
RESET='\033[0m'

#---------------------- ANIMATION -------------------#
animate_text() {
  text="$1"
  for (( i=0; i<${#text}; i++ )); do
    echo -ne "${text:$i:1}"
    sleep 0.015
  done
  echo ""
}

rainbow() {
  local colors=("\033[1;31m" "\033[1;33m" "\033[1;32m" "\033[1;36m" "\033[1;34m" "\033[1;35m")
  local text="$1"
  for (( i=0; i<${#text}; i++ )); do
    echo -ne "${colors[$((i % 6))]}${text:$i:1}${RESET}"
    sleep 0.02
  done
  echo ""
}

progress_bar() {
  echo -ne "${CYAN}"
  for ((i = 0; i <= 30; i++)); do
    echo -ne "█"
    sleep 0.05
  done
  echo -e "${RESET}"
}

#---------------------- LOGO ------------------------#
clear
echo -e "${CYAN}"
cat <<'EOF'
  _________                  __.__  __      ________    _____      _____  .___ _______    ________  
 /   _____/____    ____     |__|__|/  |_   /  _____/   /  _  \    /     \ |   |\      \  /  _____/  
 \_____  \\__  \  /    \    |  |  \   __\ /   \  ___  /  /_\  \  /  \ /  \|   |/   |   \/   \  ___  
 /        \/ __ \|   |  \   |  |  ||  |   \    \_\  \/    |    \/    Y    \   /    |    \    \_\  \ 
/_______  (____  /___|  /\__|  |__||__|    \______  /\____|__  /\____|__  /___\____|__  /\______  / 
        \/     \/     \/\______|                  \/         \/         \/            \/        \/  
-----------------------------------------------------------------------------------------------
                 ⚙️  Custom Pterodactyl PRO Installer  |  Powered by @its_sadaf_officail
-----------------------------------------------------------------------------------------------
EOF
echo -e "${RESET}"
sleep 2

#---------------------- MENU ------------------------#
menu() {
  clear
  rainbow "🔥 Welcome to Pterodactyl PRO Installer 🔥"
  echo ""
  echo -e "${YELLOW}Choose an option:${RESET}"
  echo "-----------------------------------------"
  echo -e "${GREEN}[1]${RESET} Install Panel"
  echo -e "${GREEN}[2]${RESET} Install Wings"
  echo -e "${GREEN}[3]${RESET} Install Panel + Wings + Blueprint Theme"
  echo -e "${RED}[4]${RESET} Uninstall Everything"
  echo -e "${CYAN}[0]${RESET} Exit"
  echo "-----------------------------------------"
  read -p "Enter your choice: " choice

  case $choice in
    1) install_panel ;;
    2) install_wings ;;
    3) install_all ;;
    4) uninstall_all ;;
    0) animate_text "${YELLOW}Exiting...${RESET}"; exit 0 ;;
    *) animate_text "${RED}Invalid choice!${RESET}"; sleep 1; menu ;;
  esac
}

#---------------------- PANEL -----------------------#
install_panel() {
  animate_text "${BLUE}[*] Installing Pterodactyl Panel...${RESET}"
  progress_bar
  bash <(curl -sSL https://raw.githubusercontent.com/pterodactyl-installer/pterodactyl-installer/master/install-panel.sh)
}

#---------------------- WINGS -----------------------#
install_wings() {
  animate_text "${BLUE}[*] Installing Pterodactyl Wings...${RESET}"
  progress_bar
  bash <(curl -sSL https://raw.githubusercontent.com/pterodactyl-installer/pterodactyl-installer/master/install-wings.sh)
}

#---------------------- THEME -----------------------#
install_theme() {
  animate_text "${MAGENTA}[*] Installing Blueprint Theme...${RESET}"
  progress_bar
  cd /var/www/pterodactyl || exit
  curl -sSL https://raw.githubusercontent.com/BlueprintCoding/pterodactyl-theme/main/install.sh | bash
  chown -R www-data:www-data /var/www/pterodactyl/*
}

#---------------------- ALL -------------------------#
install_all() {
  install_panel
  install_wings
  install_theme
  animate_text "${GREEN}✅ All installations completed successfully!${RESET}"
}

#---------------------- UNINSTALL -------------------#
uninstall_all() {
  animate_text "${RED}[*] Removing Pterodactyl and Wings...${RESET}"
  progress_bar
  systemctl stop wings 2>/dev/null || true
  systemctl disable wings 2>/dev/null || true
  rm -rf /etc/pterodactyl /var/www/pterodactyl /var/lib/pterodactyl /usr/local/bin/wings
  animate_text "${GREEN}✅ Uninstallation complete.${RESET}"
}

#---------------------- START -----------------------#
menu
